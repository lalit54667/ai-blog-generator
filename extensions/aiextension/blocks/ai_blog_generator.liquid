{{ 'blog-style.css' | asset_url | stylesheet_tag }}

{% if request.design_mode %}
  <div class="ai-blog-tool">
    <h2>üìù AI Blog Generator</h2>
    <input type="text" id="blogTopic" placeholder="Enter blog topic..." />
    <input type="number" id="wordCount" placeholder="Word Count (e.g., 500)" />
    <button onclick="generatePreview()">Generate Preview</button>
    <p id="blogStatus"></p>

    <div id="blogPreview" style="margin-top:20px; border:1px solid #ccc; padding:10px; display:none;"></div>
    <button id="postBtn" style="display:none;" onclick="postBlog()">‚úÖ Post This Blog</button>
  </div>

  <script>
    let generatedContent = "";
    let blogImage = "";
    let blogTitle = "";

    async function generatePreview() {
      const topic = document.getElementById('blogTopic').value;
      const wordCount = document.getElementById('wordCount').value || 500;
      document.getElementById('blogStatus').innerText = '‚è≥ Generating preview...';

      try {
        const res = await fetch("https://374f39c8c2ff.ngrok-free.app/generate-blog-preview", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic, wordCount })
        });

        const data = await res.json();
        if (data.success) {
          generatedContent = data.preview;
          blogImage = data.image;
          blogTitle = data.title;
          document.getElementById('blogPreview').innerHTML = data.preview;
          document.getElementById('blogPreview').style.display = "block";
          document.getElementById('postBtn').style.display = "inline-block";
          document.getElementById('blogStatus').innerText = "‚úÖ Preview generated. Ready to post!";
        } else {
          document.getElementById('blogStatus').innerText = "‚ùå Error: " + data.error;
        }
      } catch (err) {
        console.error(err);
        document.getElementById('blogStatus').innerText = "‚ùå Request failed.";
      }
    }

    async function postBlog() {
      document.getElementById('blogStatus').innerText = 'üöÄ Posting blog...';

      try {
        const res = await fetch("https://374f39c8c2ff.ngrok-free.app/post-blog", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title: blogTitle, content: generatedContent, image: blogImage })
        });

        const data = await res.json();
        if (data.success) {
          document.getElementById('blogStatus').innerText = "‚úÖ Blog posted successfully!";
        } else {
          document.getElementById('blogStatus').innerText = "‚ùå Post failed: " + data.error;
        }
      } catch (err) {
        console.error(err);
        document.getElementById('blogStatus').innerText = "‚ùå Request failed.";
      }
    }
  </script>
{% endif %}

{% schema %}
{
  "name": "AI Blog Generator",
  "target": "section",
  "settings": []
}
{% endschema %}
